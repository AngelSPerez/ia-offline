<!DOCTYPE html>
<html lang="es">
<head>
    
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhyAI</title>
    
    <link rel="manifest" href="manifest.json">
    
    <meta name="theme-color" content="#181818">

    <link rel="apple-touch-icon" href="images/icons/icon-192x192.png">

    <link rel="icon" href="icons/512.png">

    <link rel="stylesheet" href="high.css">

    <style>
      body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background-color: #1c1c1c;
        color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      }

      .iframe-container {
        width: 100%;
        height: 100%;
        position: absolute;
        z-index: 9999;
        display: none;
      }
      
      iframe {
        border: none;
      }

      /* --- INDICADOR ONLINE --- */
      #online-indicator {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 9999;
        background-color: transparent;
        border: 1px solid #888;
        border-radius: 20px;
        padding: 6px 14px;
        font-family: ui-sans-serif, system-ui, sans-serif;
        font-size: 0.85rem;
        color: #ccc;
        pointer-events: auto;
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        transition: border-color 0.2s, background-color 0.2s;
        margin-right: 12%;
      }

      #online-indicator:hover {
        border-color: #aaa;
        background-color: rgba(255, 255, 255, 0.05);
      }

      #online-indicator::before {
        content: "‚óè";
        color: #4ade80;
        font-size: 0.75rem;
      }

      @media (max-width: 1028px) {
        #online-indicator {
          top: 12px;
          right: 12px;
          font-size: 0.8rem;
          padding: 5px 12px;
          cursor: pointer;
          margin-right: 0px;
        }
      }

      /* === BOT√ìN GENERAR IMAGEN === */
      #image-gen-btn {
        position: absolute;
        top: 14px;
        right: 70px;
        width: 23px;
        height: 23px;
        cursor: pointer;
        z-index: 99999;
        border-radius: 50%;
        background: #1a1a1a;
        margin-right: 17%;
        border: 1px solid #444;
        padding: 6px;
        transition: all 0.2s;
      }

      #image-gen-btn:hover {
        border-color: #666;
        background: #202020;
        transform: scale(1.05);
      }

      @media (max-width: 1028px) {
        #image-gen-btn {
          top: 12px;
          right: 56px;
          width: 32px;
          height: 32px;
          padding: 5px;
        }
      }

      /* --- MODAL SWITCH MODE --- */
      .switch-modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 100001;
        display: flex; justify-content: center; align-items: center;
        backdrop-filter: blur(5px);
        opacity: 0; visibility: hidden; transition: opacity 0.3s ease;
      }
      
      .switch-modal-overlay.active {
        opacity: 1; visibility: visible;
      }

      .switch-modal-box {
        background: #2a2a2a; border: 1px solid #444;
        padding: 20px; border-radius: 12px; max-width: 90%; width: 400px;
        text-align: center; color: #ececec;
        font-family: ui-sans-serif, system-ui, sans-serif;
        box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        margin: 20px;
      }

      .switch-modal-box h2 {
        margin-top: 0; color: #fff; margin-bottom: 20px;
      }

      .mode-option {
        margin-bottom: 15px;
        padding: 16px;
        background: #1a1a1a;
        border-radius: 8px;
        border: 1px solid #444;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      }

      .mode-option:last-child {
        margin-bottom: 0;
      }

      .mode-option:hover {
        border-color: #666;
        background: #202020;
      }

      .mode-option.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: #151515;
        border-color: #333;
      }

      .mode-option.disabled:hover {
        border-color: #333;
        background: #151515;
      }

      /* Badge din√°mico que se actualiza con JS */
      .mode-option.disabled .current-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #4ade80;
        color: #1a1a1a;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: bold;
      }

      @media (max-width: 1028px) {
        .mode-option.disabled .current-badge {
          content: "‚úì";
          padding: 4px 8px;
          font-size: 1rem;
        }
      }

      .mode-option h3 {
        margin: 0 0 8px 0;
        font-size: 1.1rem;
        color: #4ade80;
      }

      .mode-option p {
        margin: 0;
        font-size: 0.9rem;
        color: #aaa;
        line-height: 1.4;
      }

      .close-switch-btn {
        background: transparent;
        color: #888;
        border: 1px solid #444;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: normal;
        cursor: pointer;
        margin-top: 15px;
        font-family: ui-sans-serif, system-ui, sans-serif;
        transition: all 0.2s;
        font-size: 0.9rem;
        display: inline-block;
        text-decoration: none;
      }

      .close-switch-btn:hover {
        border-color: #666;
        color: #ccc;
      }

      /* --- MODAL BIENVENIDA NUEVO USUARIO --- */
      .welcome-modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 100002;
        display: flex; justify-content: center; align-items: center;
        backdrop-filter: blur(5px);
        opacity: 0; visibility: hidden; transition: opacity 0.3s ease;
      }
      
      .welcome-modal-overlay.active {
        opacity: 1; visibility: visible;
      }

      .welcome-modal-box {
        background: #2a2a2a; border: 1px solid #444;
        padding: 15px;
        border-radius: 12px;
        max-width: 90%;
        width: 450px;
        text-align: center;
        color: #ececec;
        font-family: ui-sans-serif, system-ui, sans-serif;
        box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        margin: 15px;
      }

      .welcome-modal-box h2 {
        margin-top: 0; color: #fff; margin-bottom: 15px; font-size: 1.5rem;
      }

      .welcome-modal-box p {
        margin: 0 0 20px 0;
        color: #ccc;
        line-height: 1.6;
        font-size: 1rem;
      }

      .welcome-modal-box .highlight {
        color: #4ade80;
        font-weight: bold;
      }

      .welcome-modal-box .button-highlight {
        background: #1a1a1a;
        padding: 12px;
        border-radius: 8px;
        margin: 15px 0;
        border: 1px solid #1e703c;
        color: #4ade80;
        font-size: 0.9rem;
      }

      .welcome-btn {
        background: #4ade80;
        color: #1a1a1a;
        border: none;
        padding: 12px 30px;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        font-size: 1rem;
        font-family: ui-sans-serif, system-ui, sans-serif;
        transition: all 0.2s;
      }

      .welcome-btn:hover {
        background: #5ae890;
        transform: translateY(-2px);
      }

      .welcome-btn:active {
        transform: translateY(0);
      }

      /* --- TOAST OFFLINE --- */
      #offline-toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: rgba(42, 42, 42, 0.85);
        backdrop-filter: blur(10px);
        color: #ccc;
        padding: 10px 18px;
        border-radius: 20px;
        border: 1px solid rgba(136, 136, 136, 0.3);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        font-family: ui-sans-serif, system-ui, sans-serif;
        font-size: 0.85rem;
        z-index: 100003;
        opacity: 0;
        transition: all 0.4s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        max-width: 90%;
        text-align: center;
      }

      #offline-toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      #offline-toast::before {
        color: #888;
        font-size: 1.5rem;
        flex-shrink: 0;
      }

      @media (max-width: 768px) {
        #offline-toast {
          bottom: 15px;
          padding: 8px 16px;
          font-size: 0.8rem;
        }

        #offline-toast::before {
          font-size: 1.3rem;
        }
      }

      .off-msg {
        display: flex;
        width: 100%;
        height: 100%;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .off-msg img {
        width: 150px;
        height: 150px;
      }

      .off-msg p {
        width: 68%;
        text-align: center;
      }

      /* === ESTILOS MODAL GENERADOR DE IM√ÅGENES === */
      #image-result {
        margin-top: 15px;
        display: none;
      }

      #generated-image {
        width: 100%;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      #image-prompt {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #444;
        background: #1a1a1a;
        color: #fff;
        margin-bottom: 12px;
        font-family: ui-sans-serif, system-ui, sans-serif;
        font-size: 0.9rem;
        box-sizing: border-box;
      }

      #image-prompt:focus {
        outline: none;
        border-color: #4ade80;
      }
      
    </style>
</head>
<body>

<!-- === BOT√ìN GENERAR IMAGEN === -->
<img id="image-gen-btn" src="generar.png" onclick="abrirImageModal()" title="Generar imagen" alt="Generar imagen" />

<!-- MODAL BIENVENIDA -->
<div class="welcome-modal-overlay" id="welcome-modal">
  <div class="welcome-modal-box">
    <h2>¬°Bienvenido a WhyAI!</h2>
    <p>Esta IA tiene una <span class="highlight">versi√≥n sin conexi√≥n</span>. Si te interesa usarla sin internet:</p>
    <div class="button-highlight">
      Pulsa el bot√≥n de la esquina superior derecha
    </div>
    <p>Podr√°s instalar la versi√≥n offline y usarla en cualquier momento sin conexi√≥n a internet.</p>
    <button class="welcome-btn" onclick="cerrarWelcomeModal()" id="welcome-btn">Entendido</button>
  </div>
</div>

<!-- MODAL SWITCH MODE -->
<div class="switch-modal-overlay" id="switch-modal">
  <div class="switch-modal-box">
    <h2 id="switch-title">Switch Mode</h2>
    
    <div class="mode-option disabled" id="online-mode-option" onclick="">
      <span class="current-badge" id="current-mode-badge">Current Mode</span>
      <h3>üåê Online Mode</h3>
      <p id="online-desc">Connect to the internet for cloud-based features and updates.</p>
    </div>

    <div class="mode-option" onclick="irOffline()">
      <h3>üì± Offline Mode</h3>
      <p id="offline-desc">Use WhyAI completely offline with local models.</p>
    </div>

    <button class="close-switch-btn" onclick="cerrarSwitchModal()" id="close-switch-btn">Close</button>
  </div>
</div>

<!-- === MODAL GENERADOR DE IM√ÅGENES === -->
<div class="switch-modal-overlay" id="image-modal">
  <div class="switch-modal-box">
    <h2 id="img-title">Generar imagen</h2>

    <input
      id="image-prompt"
      type="text"
      placeholder="Describe la imagen que quieres generar"
    />

    <button class="welcome-btn" onclick="generarImagen()" id="img-generate-btn">
      Generar
    </button>

    <div id="image-result">
      <img id="generated-image" alt="Imagen generada">
      <a id="download-image" download="imagen.png" class="close-switch-btn">
        Descargar imagen
      </a>
    </div>

    <button class="close-switch-btn" onclick="cerrarImageModal()" id="img-close-btn">
      Cerrar
    </button>
  </div>
</div>

<!-- Toast Offline -->
<div id="offline-toast"></div>

<!-- Contenedor iframe -->
<div class="iframe-container">
  <iframe src="https://whyia-chat221.vercel.app/" width="100%" height="100%"></iframe>
</div>

<!-- Mensaje sin conexi√≥n -->
<div class="off-msg">
  <img src="image.png" alt="No internet connection.">
  <h1>Sin conexi√≥n</h1>
  <p>No te preocupes: WhyAI cuenta con un modo 'Offline', que te permite seguir disfrutando de la inteligencia artificial sin necesidad de conexi√≥n a Internet, siempre que la hayas descargado previamente.</p>
</div>

<!-- Indicador Online -->
<div id="online-indicator" onclick="abrirSwitchModal()">Online Mode</div>

<script>
  const translations = {
    es: {
      switchTitle: "Cambiar Modo",
      onlineDesc: "Conecta a internet para funciones basadas en la nube y actualizaciones.",
      offlineDesc: "Usa WhyAI completamente offline con modelos locales.",
      closeSwitchBtn: "Cerrar",
      currentModeBadge: "‚úì Modo Actual",
      currentModeBadgeMobile: "‚úì",
      welcomeText: "Esta IA tiene una <span class=\"highlight\">versi√≥n sin conexi√≥n</span>. Si te interesa usarla sin internet:",
      welcomeButton: "Pulsa el bot√≥n de la esquina superior derecha, despues de esta pantalla.",
      welcomeFooter: "Podr√°s instalar la versi√≥n offline y usarla en cualquier momento sin conexi√≥n a internet.",
      welcomeBtn: "Entendido",
      offlineToast: "Sin conexi√≥n a internet. Cambia a Offline Mode si lo has descargado.",
      offlineMsgTitle: "Sin conexi√≥n",
      offlineMsgText: "No te preocupes: WhyAI cuenta con un modo 'Offline', que te permite seguir disfrutando de la inteligencia artificial sin necesidad de conexi√≥n a Internet, siempre que la hayas descargado previamente.",
      imgTitle: "Generar imagen",
      imgPlaceholder: "Describe la imagen que quieres generar",
      imgGenerate: "Generar",
      imgDownload: "Descargar imagen",
      imgClose: "Cerrar"
    },
    en: {
      switchTitle: "Switch Mode",
      onlineDesc: "Connect to the internet for cloud-based features and updates.",
      offlineDesc: "Use WhyAI completely offline with local models.",
      closeSwitchBtn: "Close",
      currentModeBadge: "‚úì Current Mode",
      currentModeBadgeMobile: "‚úì",
      welcomeText: "This AI has an <span class=\"highlight\">offline version</span>. If you're interested in using it without internet:",
      welcomeButton: "Tap the button in the top right corner, after this screen.",
      welcomeFooter: "You'll be able to install the offline version and use it anytime without internet connection.",
      welcomeBtn: "Got it",
      offlineToast: "No internet connection. Switch to Offline Mode if you've downloaded it.",
      offlineMsgTitle: "No connection",
      offlineMsgText: "Don't worry: WhyAI has an 'Offline' mode that lets you continue enjoying AI without internet connection, as long as you've downloaded it previously.",
      imgTitle: "Generate image",
      imgPlaceholder: "Describe the image you want to generate",
      imgGenerate: "Generate",
      imgDownload: "Download image",
      imgClose: "Close"
    }
  };

  let currentLang = 'en';

  // ‚úÖ FUNCIONES MODAL GENERADOR DE IM√ÅGENES
  function abrirImageModal() {
    document.getElementById('image-modal').classList.add('active');
  }

  function cerrarImageModal() {
    document.getElementById('image-modal').classList.remove('active');
    // Resetear el modal
    document.getElementById('image-prompt').value = '';
    document.getElementById('image-result').style.display = 'none';
  }

  function generarImagen() {
    const prompt = document.getElementById('image-prompt').value.trim();
    if (!prompt) {
      alert(currentLang === 'es' ? 'Por favor, describe la imagen que deseas generar' : 'Please describe the image you want to generate');
      return;
    }

    const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=512&height=512&nologo=true`;
    document.getElementById('generated-image').src = url;
    document.getElementById('download-image').href = url;
    document.getElementById('image-result').style.display = 'block';
  }

  // ‚úÖ SOLO IDIOMA DEL NAVEGADOR
  function detectarIdioma() {
    const userLang = navigator.language || navigator.userLanguage || 'en';
    const language = userLang.toLowerCase().startsWith('es') ? 'es' : 'en';
    aplicarIdioma(language);
  }

  function aplicarIdioma(lang) {
    currentLang = lang;
    const t = translations[lang] || translations.en;

    // Traducir Switch Modal
    document.getElementById('switch-title').textContent = t.switchTitle;
    document.getElementById('online-desc').textContent = t.onlineDesc;
    document.getElementById('offline-desc').textContent = t.offlineDesc;
    document.getElementById('close-switch-btn').textContent = t.closeSwitchBtn;

    // ‚úÖ ACTUALIZAR EL BADGE DIN√ÅMICAMENTE
    const badge = document.getElementById('current-mode-badge');
    const isMobile = window.innerWidth <= 1028;
    badge.textContent = isMobile ? t.currentModeBadgeMobile : t.currentModeBadge;

    // Traducir Welcome Modal
    const welcomeText = document.querySelectorAll('.welcome-modal-box p')[0];
    const welcomeButtonDiv = document.querySelector('.button-highlight');
    const welcomeFooter = document.querySelectorAll('.welcome-modal-box p')[1];
    const welcomeBtn = document.getElementById('welcome-btn');

    welcomeText.innerHTML = t.welcomeText;
    welcomeButtonDiv.innerHTML = ' ' + t.welcomeButton;
    welcomeFooter.textContent = t.welcomeFooter;
    welcomeBtn.textContent = t.welcomeBtn;

    // ‚úÖ TRADUCIR MENSAJE OFFLINE
    document.querySelector('.off-msg h1').textContent = t.offlineMsgTitle;
    document.querySelector('.off-msg p').textContent = t.offlineMsgText;

    // ‚úÖ TRADUCIR MODAL GENERADOR DE IM√ÅGENES
    document.getElementById('img-title').textContent = t.imgTitle;
    document.getElementById('image-prompt').placeholder = t.imgPlaceholder;
    document.getElementById('img-generate-btn').textContent = t.imgGenerate;
    document.getElementById('download-image').textContent = t.imgDownload;
    document.getElementById('img-close-btn').textContent = t.imgClose;
  }

  // ‚úÖ ACTUALIZAR EL BADGE AL CAMBIAR EL TAMA√ëO DE LA VENTANA
  window.addEventListener('resize', () => {
    const t = translations[currentLang];
    const badge = document.getElementById('current-mode-badge');
    const isMobile = window.innerWidth <= 1028;
    badge.textContent = isMobile ? t.currentModeBadgeMobile : t.currentModeBadge;
  });

  function abrirSwitchModal() {
    document.getElementById('switch-modal').classList.add('active');
  }

  function cerrarSwitchModal() {
    document.getElementById('switch-modal').classList.remove('active');
  }

  function cerrarWelcomeModal() {
    document.getElementById('welcome-modal').classList.remove('active');
    localStorage.setItem('whyai-visited', 'true');
  }

  function mostrarWelcomeModal() {
    if (!localStorage.getItem('whyai-visited')) {
      setTimeout(() => {
        document.getElementById('welcome-modal').classList.add('active');
      }, 500);
    }
  }

  function irOffline() {
    window.location.href = 'offline.html';
  }

  function mostrarToastOffline() {
    const toast = document.getElementById('offline-toast');
    toast.textContent = translations[currentLang].offlineToast;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 5000);
  }

  window.addEventListener('offline', mostrarToastOffline);
  window.addEventListener('online', () => {
    document.getElementById('offline-toast').classList.remove('show');
  });

  // ‚úÖ DETECTOR DE INTERNET PARA IFRAME (MEJORADO)
  function verificarConexion() {
    const iframeContainer = document.querySelector('.iframe-container');
    const offMsg = document.querySelector('.off-msg');
    
    if (navigator.onLine) {
      // Hay internet - mostrar iframe, ocultar mensaje offline
      iframeContainer.style.display = 'block';
      offMsg.style.display = 'none';
    } else {
      // No hay internet - ocultar iframe, mostrar mensaje offline
      iframeContainer.style.display = 'none';
      offMsg.style.display = 'flex';
    }
  }

  // Verificaci√≥n m√°s robusta al cargar
  function verificarConexionInicial() {
    // Intentar hacer una petici√≥n al servidor del iframe para verificar conexi√≥n real
    fetch('https://whyia-chat221.vercel.app/', { 
      mode: 'no-cors',
      cache: 'no-store'
    })
    .then(() => {
      // Hay conexi√≥n real
      const iframeContainer = document.querySelector('.iframe-container');
      const offMsg = document.querySelector('.off-msg');
      iframeContainer.style.display = 'block';
      offMsg.style.display = 'none';
    })
    .catch(() => {
      // No hay conexi√≥n real
      const iframeContainer = document.querySelector('.iframe-container');
      const offMsg = document.querySelector('.off-msg');
      iframeContainer.style.display = 'none';
      offMsg.style.display = 'flex';
    });
  }

  // Verificar conexi√≥n al cargar la p√°gina con m√©todo robusto
  verificarConexionInicial();

  // Escuchar cambios en la conexi√≥n en tiempo real
  window.addEventListener('online', verificarConexion);
  window.addEventListener('offline', verificarConexion);

  // Inicializar
  detectarIdioma();
  mostrarWelcomeModal();

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/ia-offline/sw.js');
    });
  }
</script>

</body>

</html>
